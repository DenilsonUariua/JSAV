<!DOCTYPE html>
<html>
  <head>
    <title>Creating an Exercise with JavaScript Algorithm Visualization API (JSAV) Version 0.3</title>
    <style>
    .todo, .note {
      border: 2px solid red;
      border-radius: 4px;
      padding: 10px;
      background-color: #eee;
      font-weight: bold;
    }
    .note {
      border-color: green;
    }
    .todo:before, .note:before {
      content: "TODO: ";
      color: red;
      padding-right: 20px;
    }
    .note:before {
      content: "NOTE: ";
      color: green;
    }
    h2 {
      border-bottom: 1px dashed #bbb;
    }
    h3 {
      border-left: 3px solid #bbb;
      padding-left: 5px;
    }
    h3.apimethod {
      font-family: monospace;
    }
    body {
      margin: 20px;
    }
    p, ul, ol, dl {
      margin-left: 10px;
    }
    pre {
      margin-left: 20px ;
    }
    pre, code {
      background-color: #eee;
      padding: 3px;
      border: 1px dashed #bbb;
      border-radius: 3px;
    }
    </style>
  </head>

<body>
<h1>Creating an Exercise with JavaScript Algorithm Visualization API (JSAV) Version 0.3</h1>

<p>This tutorial will walk you through the code needed to create a
simple exercise.
The user of the exercise is supposed to click array positions in order
from left to right to highlight each cell.
A point is scored for each correctly selected cell.
The options panel lets the user choose from various standard settings
for controlling the exercise, including whether feedback for incorrect
steps should be given, and whether such incorrect steps should be
corrected or not.
For the final code version,
see the file [JSAV]/examples/simple-exercise.html.</p> 

<p>
The <a href="api.html">API docs</a> provide complete documentation for
the various library APIs.

<h2>Setting Up</h2>

<p>
First, like any HTML file we need a header to define the document
type, title, and any CSS files to be used.
</p>

<pre>
&lt;!DOCTYPE html>
&lt;html>
&lt;head>
&lt;title>ShellSort Proficiency Exercise</title>
&lt;link href="AeBookAV.css" rel="stylesheet" type="text/css" />
&lt;link rel="stylesheet" href="../css/JSAV.css" type="text/css" />
&lt;/head>
</pre>

<p>
In this case, we included the standard JSAV.css file, as well as the
CSS file used by OpenDSA textbook components (AeBookAV.css).
</p>

<p>
Next, we will define the various DOM elements on the HTML page.
</p>

<pre>
  &lt;div id="jsavcontainer">
    &lt;a class="jsavsettings" href="#">Settings&lt;/a>
    &lt;p class="jsavexercisecontrols">&lt;/p>
    &lt;ol id="exerArray">&lt;/ol>
  &lt;/div>
</pre>

<p>
Here we have create two standard elements that typically appear in a
JSAV exercise: the options (or "settings") panel, and the exercise
standard controls.
These include the ability to regenerate a new instance of the exercise
("reset"), a slideshow showing the "model answer", and information
about the grade received on the exercise.
We also created a placeholder for what will be the displayed array.
</p>

<p>
Next we load in the various libraries.
</p>

<pre>
    &lt;script
       src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.3/jquery.min.js">
    &lt;/script>
    &lt;script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.13/jquery-ui.min.js">&lt;/script>
    &lt;script src="../lib/jquery.transform.light.js">&lt;/script>
    &lt;script src="../build/JSAV.js">&lt;/script>
</pre>

<p>
We use the standard jquery libraries, and we also load the JSAV
library.
</p>

<p>
Next comes JavaScript setup and variable definitions specific to
the exercise.
</p>

<pre>
  var arraySize = 8,
      initialArray = [],
      jsavArray,
      $array = $("#exerArray"),
      av = new JSAV($("#jsavcontainer"));
</pre>

<p>
<b>TODO: Explain the variables here.</b>
</p>

<p>
<b>TODO: Next comes something odd.</b>
</p>
<pre>
    av.recorded(); // we are not recording an AV with an algorithm
</pre>

<p>
<b>TODO: I do not know why this is needed.</b>
</p>

<h2>Write an Initialization Function</h2>

<p>The first step in creating an exercise is to write a function that
initializes the exercise.
This method will be called both on startup, and by the "reset"
button.
The <code>initialize()</code> function should clear the previous
visualization (if there was one) and initialize a new one.
It should also return the structures that will be used in grading to
compare with the model answer. 
The name of the function does not have to be "initialize", as
it will be bound in the initializer method for the exercise object,
as shown later in the tutorial.
</p>


<pre>
  function initialize() {
    var htmldata = "";
    for (var i = arraySize; i > 0; i--) {
      var randomVal = Math.floor(Math.random()*100);
      htmldata += "&lt;li>" + randomVal + "&lt;/li>";
      initialArray[arraySize-i] = randomVal;
    }
    $array.html(htmldata);

    jsavArray = av.ds.array($array, {indexed: true});
    return jsavArray;
  }
</pre>

<p>
Our example here is a simplified version of the one used by
the Shellsort Proficiency Exercise.
This code generates random numbers and changes the content
of an existing HTML element.
In the HTML, there is an element <code>&lt;ol id="exerArray">&lt;/ol></code>
and the <code>$theArray</code> variable is a jQuery object that refers
to that element (<code>var $theArray = $("#exerArray")</code>).
The <code>$theArray.html(..)</code> function call replaces the existing
array contents with new data.
The call to <code>av.ds.array</code> initializes a new JSAV array from 
the given jQuery object and the given options. Finally, the function
returns the JSAV array.
</p>

<h2>Write the Model Answer Function</h2>
<p>To be able to grade the student's solution, the exercise will need
to have a model solution.
This will be used both to show the correct solution (as an AV shown to
the student through the "Model Answer" button) and to compare to the
student's answer to judge correctness.
Below is a simple model answer function where the correct solution is
to highlight the array indices from left (index 0) to right
(index arraySize-1).

<pre>
  function modelSolution(jsav) {
    var modelArray = jsav.ds.array(initialArray);
    for (var i = 0; i &lt; arraySize; i++) {
      modelArray.highlight(i);
      jsav.stepOption("grade", true);
      jsav.step();
    }
    return modelArray;
  }
</pre>

<p>
The function takes a single parameter (<code>jsav</code> above) that
is a reference to the JSAV animation of the model answer.
Like the initialization function, the model solution function should 
return the structures used in comparing the model solution with
student's solution
</p>

<p>The function above first creates a JSAV array using the data stored
in variable <code>initialArray</code> in the initialization
function.
It then goes through all indices in turn and highlights the current
index.
It also sets a step option for the current collection of effects and
calls <code>jsav.step()</code>.
The step option <code>grade</code> is used to mark states in the model
solution that should be used in grading.
Thus, the model solution can contain an AV with explanations and other
structures, but only the returned structures at steps where grade is
set to true, are graded.
The call to <code>jsav.step()</code> notifies the AV that  
a new step should be started.
</p>

<h2>Creating the exercise</h2>

<p>
The exercise is initialized with a call to <code>av.exercise()</code>.
The function can also take several options, some of which are
required.
<b>[TODO: The following list should be moved to the documentation, this
example should only show what is done.]</b>
The full set of options are:</p> 
<ul>
  <li><code>{model: &lt;function>}</code> The function to generate the model solution. <strong>Required.</strong></li>
  <li><code>{reset: &lt;function>}</code> The initialization function that resets the exercise. <strong>Required.</strong></li>
  <li><code>{compare: &lt;Object or Array>}</code> Specifies which properties to compare for the structures. In the example below, we set the comparison to be css property background-color, since that is changed when highlighting indices.</li>
  <li><code>{feedback: &lt;string>}</code> Will change the feedback mode, possible values continuous and atend (default). See Continuous feedback below.</li>
  <li><code>{fixmode: &lt;string>}</code> Change the behavior in continuous mode, possible values are undo and fix. The default is undo.</li>
  <li><code>{feedbackSelectable: &lt;>boolean}</code> The settings dialog will, by default, allow student to change the feedback mode. Setting this option to false disables this choice.</li>
  <li><code>{fixmodeSelectable: &lt;>boolean}</code> The settings dialog will, by default, allow student to change the behavior in continuous feedback mode. Setting this option to false disables this choice.</li>
</ul>

<p>
Given our <code>initialize</code> and <code>modelSolution</code>
functions, we initialize an exercise as follows.
</p>

<pre>
var exercise = av.exercise({model: modelSolution, 
                            reset: initialize,
                            compare: {css: "background-color"}});
exercise.reset();
</pre>

<p>
At this point, the exercise can be graded and model solution shown.
It now remains to write the code that allows the student to construct
her solution.
</p> 

<h2>Adding Student Interaction</h2>

<p>
The design of the JSAV library allows the developer to represent all
data structures using HTML elements.
It is simple to attach listeners for user actions (like mouse clicks)
to these elements using standard HTML.
looking at the HTML generated to initialize the array,
<b>[TODO: Explain what generated this. It is not so obvious.]</b>
we see that it is an <code>ol</code> element with several
<code>li</code> elements inside.
And since the exercise was to click the indices, we will
register a click event handler to these <code>li</code> elements.
This is easier than it sounds.
</p>

<pre>
  // we already have reference to the ol element, find its li children 
  // and bind a function to handle all click events
  $array.find("li").live("click", function() {
    // find the index of the clicked (variable this) element within its' parent
    var index = $array.find("li").index(this);
    // highlight the index
    jsavArray.highlight(index);
    // mark this as a gradeable step; also handles continuous feedback
    exercise.gradeableStep();
  });
</pre>

<p>
ow, the exercise should be interactive and ready for use!
</p>

<p>
<b>[TODO: I took out the pointers to more advanced topics. The
documentation for these should go into the API docs, and this file
should only contain what relates to the actual example code.]</b>
</p>

</body>
</html>
